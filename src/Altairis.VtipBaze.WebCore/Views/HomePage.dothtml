@viewModel Altairis.VtipBaze.WebCore.ViewModels.HomePageViewModel, Altairis.VtipBaze.WebCore
@masterPage Views/Site.dotmaster

<dot:Content ContentPlaceHolderID="MainContent">

    <article IncludeInPage="{value: WelcomePlaceHolderVisible}">
        <header>
            Welcome at VtipBáze.cz
        </header>
        <p>VtipBáze is a database of jokes. These jokes were kindly generated by ChatGPT or submitted by the community.</p>
        <p>If you can't find your favorite one here, <a href="/new">add it</a>.</p>
    </article>

    <dot:Repeater DataSource="{value: Jokes}">
        <EmptyDataTemplate>
            <article>
                <header>Error</header>
                <p>
                    No jokes found in this category.
                </p>
            </article>
        </EmptyDataTemplate>
        <ItemTemplate>

            <article id="{value: $"j{Id}"}">
                <header>
                    <dot:RouteLink class="id" RouteName="SingleJoke" Param-JokeId="{value: Id}" Text="{value: Id}" />
                    {{value: DateCreated}}
                </header>
                <div class="ui-widget-content ui-state-highlight ui-corner-all"
                     style="padding: .5ex 1ex; margin-bottom: 1ex;"
                     IncludeInPage="{value: !Approved}">
                    <dot:LinkButton Text="[approve]" title="Approve joke" class="ui-icon ui-icon-check"
                                    Click="{command: _root.ApproveJoke(Id)}" />
                    <dot:LinkButton Text="[reject]" title="Reject joke" class="ui-icon ui-icon-closethick"
                                    Click="{command: _root.RemoveJoke(Id)}"
                                    data-confirmprompt="Do you really want to delete this joke?" />
                    This joke was not approved yet.
                </div>
                <div>{{value: Text}}</div>
                <aside>
                    <dot:AuthenticatedView>
                        <AuthenticatedTemplate>
                            <div style="float: right">
                                <dot:TextBox style-width="120px" class="textbox ac-tag" Text="{value: TagToAdd}" list="TagList" />

                                <dot:LinkButton Text="[add]" title="Add tag" class="ui-icon ui-icon-circle-plus"
                                                Click="{command: _root.AddTag(Id, TagToAdd)}" />
                                <dot:LinkButton runat="server" Text="[clear all]" title="Clear all tags"
                                                class="ui-icon ui-icon-circle-close"
                                                Click="{command: _root.ClearTags(Id)}"
                                                data-confirmprompt="Do you really want to clear all tags from this joke?" />
                            </div>
                        </AuthenticatedTemplate>
                    </dot:AuthenticatedView>

                    <dot:Repeater DataSource="{value: Tags}" class="taglist" WrapperTagName="ul">
                        <li>
                            <span class="ui-icon ui-icon-tag"></span>
                            <dot:RouteLink Text="{value: _this}"
                                           RouteName="TagSearch"
                                           Param-TagName="{value: _this}" />
                        </li>
                    </dot:Repeater>
                </aside>
            </article>

        </ItemTemplate>
    </dot:Repeater>

    <div class="paging" IncludeInPage="{value: PagingPanelVisible}">
        <div style="float: left">
            <dot:RouteLink RouteName="{resource: Context.Route.RouteName}"
                           Param-PageIndex="1"
                           Text="&lt;&lt; first"
                           Enabled="{value: !Jokes.PagingOptions.IsFirstPage}" />
            <dot:RouteLink RouteName="{resource: Context.Route.RouteName}"
                           Param-PageIndex="{value: PageIndex - 1}"
                           Text="&lt; previous"
                           Enabled="{value: !Jokes.PagingOptions.IsFirstPage}" />
        </div>
        <dot:RouteLink RouteName="{resource: Context.Route.RouteName}"
                       Param-PageIndex="{value: PageIndex + 1}"
                       Text="next &gt;"
                       Enabled="{value: !Jokes.PagingOptions.IsLastPage}" />
        <dot:RouteLink RouteName="{resource: Context.Route.RouteName}"
                       Param-PageIndex="{value: Jokes.PagingOptions.PagesCount}"
                       Text="last &gt;&gt;"
                       Enabled="{value: !Jokes.PagingOptions.IsLastPage}" />
    </div>

    <dot:Repeater WrapperTagName="datalist" DataSource="{value: _root.TagList}" ID="TagList">
        <option value="{value: _this}"></option>
    </dot:Repeater>

</dot:Content>

